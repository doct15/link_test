bmcgehee/link_test:
  Build:
    - echo "Nothing to build"
  PkgInclude:
    - '*'
  Env:
    - PROJECTDIR: "/home/bmcgehee/public_html"
    - OWNER: "bmcgehee"
    - DIR: $PROJECTDIR
    - new: $DISTELLI_INSTALLHOME/public_html
  PostInstall:
    - # [1] Link "new" files:
    - for f in $(find "$new" \! -type d | cut -b $((${#new}+2))-); do
    -     if ! [ -e "$DIR/$f" ]; then
    -         echo "NEW:$new - /$f OLD:$DIR - /$f"
    -         echo "Creating $DIR/$(dirname $f)"
    -         sudo mkdir -p "$DIR/$(dirname $f)"
    -         sudo ln -s "$new/$f" "$DIR/$f"
    -     fi
    - done
    - # [2] Rename symlinks into place and delete "old" symlinks:
    - for f in $(find "$DIR" -type l -print0 | xargs -0 readlink | grep "^$prefix" | grep -v "^$new" | awk -F/ '{{for(n=6; n < NF+1; n++){ printf "/%s", $(n)} print ""}}' ); do
    -    if ! [ -e "$new/$f" ]; then
    -        # Delete old symlink:
    -        echo "Deleting old symlink $DIR - $f"
    -        sudo rm -rf "$DIR/$f"
    -    else
    -        # Relink, move link into place to make this
    -        # change atomically:
    -        sudo ln -s "$new/$f" "$DIR/.TEMP-LINK-$$"
    -        sudo mv -f "$DIR/.TEMP-LINK-$$" "$DIR/$f"
    -    fi
    - done
    - Changing ownership
    - cd $DISTELLI_INSTALLHOME
    - sudo chown -R $OWNER:$OWNER *
    - cd $PROJECTDIR
    - sudo chown -R $OWNER:$OWNER *



    

